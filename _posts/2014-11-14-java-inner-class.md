---
layout:     post
title:      java中内部类
keywords:   Java,  内部类, 回调, 继承，接口
category:   java
tags:		[java, 接口, 继承, 复用]
---

最近在想一个问题，Java语言为什么要设计内部类呢，经过查阅相关的书籍后在这里总结一下。

----------
## 从多继承的角度来分析 ##
C++作为比较早期的面向对象编程语言，摸着石头过河，不幸的当了炮灰，比如多重继承，在使用的过程中会出现死亡菱形的情况，而Java的设计者意识到了这个问题，所以Java是不支持多重继承的，想要扩展功能可以使用interface，但是后来Java的设计者意识到多重继承也不是一无是处，比如说当你的父类和实现的接口有相同签名的方法时，接口的方法会覆盖父类的方法，怎么办呢，这个时候内部类就应运而生了。

----------
java的非静态内部类可以使用外部类的所有成员方法和变量。这给继承多个类的同名成员并共享带来可能。同时非匿名内部类可以继承一个父类和实现多个接口，因此外部类想要多继承的类可以分别由内部类继承，并进行Override或者直接复用。然后外部类通过创建内部类的对象来使用该内部对象的方法和成员，从而达到复用的目的，这样外部内就具有多个父类的所有特征。这里的多继承可以说是外部类继承自一个内部类对象，而不是类，内部类 is in a 外部类，外部内的所有行为都是通过内部类对象动态获得的。

----------
上面所说的多继承是站在外部类的角度来看的，即它们是通过外部类引用内部类来达到多态与复用的目的。反过来，内部类继承了一个类，同时拥有了外部类的所有成员方法和属性，我们是否可以认为内部类集成了两个类呢？——一个是类层面的，一个是对象层面的（因为非静态内部类使用前一定有外部类的对象来创建它，它持有外部类某个对象的引用）。如果外部类还继承了其他类呢？内部类还是可以访问其他类的方法与属性。

----------
如果你想继承一个类或实现一个接口，但是这个接口或类中的一个方法和你构想的这个类中的一个方法的名称，参数相同，但访问权限缩小了或者是在继承时不想覆盖签名相同但功能不同的方法，所以你不能直接继承与实现它，你应该怎么办？这时候，你可以建一个内部类继承这个类或实现这个接口（当然你可以修改访问权限是可以的）。由于内部类对外部类的所有内容都是可访问的，内部类可以通过调用外部类的这个方法来重写那个类或接口。

----------
## 从回调的角度来分析 ##
编程上来说，一般使用一个库或类时，是你主动调用人家的API，这个叫Call，有的时候这样不能满足需要，需要你注册（注入）你自己的程序（比如一个对象)，然后让人家在合适的时候来调用你，这叫Callback(回调)。

设计模式中的Observer就是例子：所有的观察者都需要向自己关心的主题Observable注册，然后主题在适当时机（主题类对象的属性发生变化时）通知所有订阅它的观察者并更新，其中观察者都实现了一个统一的Observer接口中的。事件驱动机制也是这样的，你给感兴趣的事件注册相应的回调函数，当对应的事件发生了会调用回调函数，比如libevent的实现就是这样的。

再举个安卓开发的例子，安卓的button组件需要注册相应的按钮按下事件监听器，在按钮按下的时候调用注册的事件，
    {% highlight java%}
    button.setOnClickListener(new Button.OnClickListener(){
    	@override
        public void click(View v){
    	.........
    	}
    	});
 {% endhighlight java%}
new OnClickListener(...)这里是个匿名内部类，实现了onClick接口，我们给Button注册相应的回调事件，当按钮被按下时调用click里面的代码。


----------
## 从闭包的角度 ##
javaScript中闭包的产生是由于JavaScript中允许内部function，也就是在一个function内部声明的function。内部function可以访问外部 function中的局部变量、传入的参数和其它内部function。当内部 function可以在包含它的外部 function之外被引用时，就形成了一个闭包。这个时候，即便外部 function 已经执行完成，该内部 function 仍然可以被执行，并且其中所用到的外部function的局部变量、传入的参数等仍然保留外部function执行结束时的值。下面是一个例子：

    function Outer(){  
    var i=0;  
    function Inner(){  
    alert(++i);  
    }  
    return Inner;  
    }  
    var inner = Outer();  
    inner();  
 
因为函数Outer外的变量inner引用了函数Outer内的函数Inner，就是说：当函数Outer的内部函数Inner被函数Outer外的一个变量inner引用的时候，就创建了一个闭包。

闭包有什么作用：简而言之，闭包的作用就是在Outer执行完并返回后，闭包使得Javascript的垃圾回收机制GC不会收回Outer所占用的资源，因为Outer的内部函数Inner的执行需要依赖Outer中的变量。

闭包是一个可调用的对象，它记录了一些信息，这些信息来自于创建它的作用域。通过这个定义，可以看出内部类是面向对象的闭包，因为它不仅包含创建内部类的作用域的信息，还自动拥有一个指向此外围类对象的引用，在此作用域内，内部类有权操作所有的成员，包括private成员。
